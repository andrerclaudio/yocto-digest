# =========================================================================
# Enable uninative support
# =========================================================================
require conf/distro/include/no-static-libs.inc
require conf/distro/include/yocto-uninative.inc
INHERIT += "uninative"

# Set common distrooverrides for all ST distro
DISTROOVERRIDES =. "openstlinuxcommon:"

DISTRO_NAME                         = "ST Custom Distro, Linux"
DISTRO                              = "st-custom"
DISTRO_VERSION                     += "v1.0"
MAINTAINER                          = "Andre Ribeiro <andre.ribeiro.srs@gmail.com>"

#--------------------------
# Tune build config display
#
BUILDCFG_VARS += "DISTRO_CODENAME"
BUILDCFG_VARS += "${@'ACCEPT_EULA_' + d.getVar('MACHINE')}"
BUILDCFG_VARS += "GCCVERSION"
BUILDCFG_VARS += "PREFERRED_PROVIDER_virtual/kernel"

# Warning: TARGET_VENDOR does not contains a valid OS/ARCH name like : linux, arm
STM32MP_TARGETVENDOR ?= "-ostl"
TARGET_VENDOR = "${STM32MP_TARGETVENDOR}"

# Append distro name to each image name
IMAGE_BASENAME:append = "-${DISTRO}"

# =========================================================================
# DISTRO features
# =========================================================================
DISTRO_FEATURES  = "alsa"
DISTRO_FEATURES += "argp"
DISTRO_FEATURES += "ext2"
DISTRO_FEATURES += "ext4"
DISTRO_FEATURES += "largefile"
DISTRO_FEATURES += "ipv4"
DISTRO_FEATURES += "ipv6"
DISTRO_FEATURES += "multiarch"
DISTRO_FEATURES += "pci"
DISTRO_FEATURES += "wifi"
DISTRO_FEATURES += "nfs"
DISTRO_FEATURES += "usbgadget"
DISTRO_FEATURES += "usbhost"
DISTRO_FEATURES += "xattr"
DISTRO_FEATURES += "zeroconf"
DISTRO_FEATURES += "bluetooth"
DISTRO_FEATURES += "bluez5"

# add support of gstreamer
DISTRO_FEATURES:append = " gstreamer "

# add support of optee
DISTRO_FEATURES:append = " optee "

# add support of splashscreen
DISTRO_FEATURES:append = " splashscreen "

# add support of wayland
DISTRO_FEATURES:append = " wayland pam "

# add support of systemd
DISTRO_FEATURES:append = " systemd "
DISTRO_FEATURES:append = " polkit "

# add support of efi
DISTRO_FEATURES:append:aarch64 = " efi "

# add support of autoresize through InitRD
# DISTRO_FEATURES:append = " autoresize "

# Disabling sysvinit
DISTRO_FEATURES_BACKFILL_CONSIDERED += "sysvinit"

VIRTUAL-RUNTIME_init_manager = "systemd"
VIRTUAL-RUNTIME_initscripts = "systemd-compat-units"

# =========================================================================
# IMAGE addons
# =========================================================================
IMAGE_LINGUAS = "en-us en-gb"

LICENSE_FLAGS_ACCEPTED += " non-commercial commercial"

# =========================================================================
# DISTRO features
# =========================================================================
DISTRO_FEATURES:append = " opengl"
DISTRO_FEATURES:remove = " x11 "
# with X11
#PREFERRED_PROVIDER_virtual/xserver = "${@bb.utils.contains('DISTRO_FEATURES', 'x11 wayland', 'xwayland', 'xserver-xorg', d)}"

DISTRO_FEATURES:append = " gplv3 "

#--------------------------
# Preferred provider
# splash
SPLASH = "${@bb.utils.contains('COMBINED_FEATURES', 'splashscreen', 'psplash-drm', '', d)}"
PREFERRED_PROVIDER_virtual/psplash = "${@bb.utils.contains('COMBINED_FEATURES', 'splashscreen', 'psplash-drm', '', d)}"






# Set features we want on all NXP devices. Also disables any features not
# explicitly mentioned.
# DISTRO_FEATURES                     = " \
#                                         en-us-locale \
#                                         ipv4 \
#                                         ipv6 \
#                                         systemd \
#                                         usbgadget \
#                                         usbhost \
#                                         wifi \
#                                         zeroconf \
#                                         \
#                                     "           

# Set Systemd as Init manager software
# INIT_MANAGER                        = "systemd"

# Remove TAR artifact to improve bitbake time and download speed
# SOC_DEFAULT_IMAGE_FSTYPES:remove    = " tar.zst"
